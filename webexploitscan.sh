#!/bin/bash
#
#    Program : webexploitscan.sh
#            :
#     Author : Deraoui Saïd <said@deraoui.be>
#            :
# Parameters : --help
#            : --version
#            :
#            :
#    Licence : GPL
#      Notes : See --help for details
#============:==============================================================

PROGNAME=`basename $0`
PROGPATH=`echo $0 | /bin/sed -e 's,[\\/][^\\/][^\\/]*$,,'`
REVISION="1.0.0.0"
COUNTPHASE="25"
print_usage() {
        echo "Usage: $PROGNAME [-f folder ] [-n namefile ]"
		echo "		-f or -folder  : Folder Web for check recursive"
        echo "		-n or -name    : rapport file name"
	echo ""
		echo "Usage: $PROGNAME --help -h"
        echo "Usage: $PROGNAME --version -v -V"
}
print_help() {
        echo "$PROGNAME $REVISION"
        echo ""
        echo "Scanner Web Exploit"
        echo ""
        print_usage
        echo ""
        echo "Scanner Web Exploit. © GPL Deraoui Said 2016"
        echo ""
        exit 0
#        support
}
# First Chec dependance tools : 

GREP="/bin/grep"
FIND="/usr/bin/find"
CAT="/bin/cat"
AWK="/usr/bin/awk"
datelog=`date "+%F %H:%M:%S"`
if [ "$(id -u)" != "0" ]; then
	echo "This script must be run as root" 1>&2
	echo "Please use sudo or execute on root" 1>&2
	exit 1
fi
# If we have arguments, process them.
while test -n "$1"; do
	case "$1" in
		--help)
			print_help
			exit 0
			;;
		-h)
			print_help
			exit 0
			;;
		--version)
			echo ""				
			echo "$PROGNAME $REVISION"
			echo ""
			exit 0
			;;
		-V)
			echo ""				
			echo "$PROGNAME $REVISION"
			echo ""
			exit 0
			;;
		-v)
			echo ""				
			echo "$PROGNAME $REVISION"
			echo ""
			exit 0
			;;	

		-f)
			FOLDER=$2;
			shift;
			;;
		-F)
			FOLDER=$2;
			shift;
			;;
		-folder)
			FOLDER=$2;
			shift;
			;;
		-n)
			rapportname=$2
			shift;
			;;
		-N)
			rapportname=$2
			shift;
			;;
		-name)
			rapportname=$2
			shift;
			;;
		*)
			echo "Unknown argument: $1"
			print_usage
			exit 1
			;;
	esac
	shift
done

if [ "$FOLDER" = "" ]; then
	echo -e "Not specified directory ... Please check.."
	echo -e "exemple : -f /var/www/"
	exit 1
fi

if [ "$rapportname" = "" ]; then
	rapportname="rapport_scanwebexploit"
fi

if [ -e "$rapportname" ]
	then
		mv $rapportname.txt $rapportname.txt_old
		touch $rapportname.txt
		rapportnamef=$rapportname.txt		
	else 
		touch $rapportname.txt
		rapportnamef=$rapportname.txt		
fi 
echo "" > $rapportnamef
echo "" >> $rapportnamef

echo "..##......##.########.########..########.##.....##.########..##........#######..####.########..######...######.....###....##....##"	>> $rapportnamef
echo "..##..##..##.##.......##.....##.##........##...##..##.....##.##.......##.....##..##.....##....##....##.##....##...##.##...###...##"	>> $rapportnamef
echo "..##..##..##.##.......##.....##.##.........##.##...##.....##.##.......##.....##..##.....##....##.......##........##...##..####..##"	>> $rapportnamef
echo "..##..##..##.######...########..######......###....########..##.......##.....##..##.....##.....######..##.......##.....##.##.##.##"	>> $rapportnamef
echo "..##..##..##.##.......##.....##.##.........##.##...##........##.......##.....##..##.....##..........##.##.......#########.##..####"	>> $rapportnamef
echo "..##..##..##.##.......##.....##.##........##...##..##........##.......##.....##..##.....##....##....##.##....##.##.....##.##...###"	>> $rapportnamef
echo "...###..###..########.########..########.##.....##.##........########..#######..####....##.....######...######..##.....##.##....##"	>> $rapportnamef

echo ""	>> $rapportnamef
echo "" >> $rapportnamef
echo "Start : $datelog" >> $rapportnamef
echo "Type  : $rapportype" >> $rapportnamef
echo "Rapport name: $rapportnamef" >> $rapportnamef
echo "Scan folder : $FOLDER"  >> $rapportnamef
echo "Version : $REVISION"  >> $rapportnamef
echo "Scan Phase count : $COUNTPHASE"  >> $rapportnamef
echo ""	 >> $rapportnamef
echo ""	 >> $rapportnamef
echo ""
echo ""
echo " ██╗    ██╗███████╗██████╗ ███████╗██╗  ██╗██████╗ ██╗      ██████╗ ██╗████████╗███████╗ ██████╗ █████╗ ███╗   ██╗ "
echo " ██║    ██║██╔════╝██╔══██╗██╔════╝╚██╗██╔╝██╔══██╗██║     ██╔═══██╗██║╚══██╔══╝██╔════╝██╔════╝██╔══██╗████╗  ██║ "
echo " ██║ █╗ ██║█████╗  ██████╔╝█████╗   ╚███╔╝ ██████╔╝██║     ██║   ██║██║   ██║   ███████╗██║     ███████║██╔██╗ ██║ "
echo " ██║███╗██║██╔══╝  ██╔══██╗██╔══╝   ██╔██╗ ██╔═══╝ ██║     ██║   ██║██║   ██║   ╚════██║██║     ██╔══██║██║╚██╗██║ "
echo " ╚███╔███╔╝███████╗██████╔╝███████╗██╔╝ ██╗██║     ███████╗╚██████╔╝██║   ██║   ███████║╚██████╗██║  ██║██║ ╚████║ "
echo " ╚══╝╚══╝ ╚══════╝╚═════╝ ╚══════╝╚═╝  ╚═╝╚═╝     ╚══════╝ ╚═════╝ ╚═╝   ╚═╝   ╚══════╝ ╚═════╝╚═╝  ╚═╝╚═╝  ╚═══╝ "
echo ""
echo "/!\\ The scan includes $COUNTPHASE tests if your web space is large, it can that it takes time. "
echo "     It is better to use screen to avoided an interrupt when you scan through ssh"
echo ""
echo "Start : $datelog"
echo "Rapport name: $rapportnamef"
echo "Scan folder : $FOLDER"
echo "Version : $REVISION"
echo "Scan Phase count : $COUNTPHASE"
echo ""
unset datelog

datelog=`date "+%F %H:%M:%S"`
echo -e "[ $datelog ] Scan phase 1/$COUNTPHASE: Search suspected file 1 charset extention .php							[Please Wait]"
echo -e "[ $datelog ] Scan phase 1/$COUNTPHASE: Search suspected file 1 charset extention .php" >> $rapportnamef
echo -e "--------------------------------------------------------------------------------------------------------" >> $rapportnamef
$FIND $FOLDER -type f -iname ?.php -uid 33 >> $rapportnamef
unset datelog

datelog=`date "+%F %H:%M:%S"`
echo -e "[ $datelog ] Scan phase 2/$COUNTPHASE: Search suspected file 2 charset extention .php							[Please Wait]"
echo -e "[ $datelog ] Scan phase 2/$COUNTPHASE: Search suspected file 2 charset extention .php" >> $rapportnamef
echo -e "--------------------------------------------------------------------------------------------------------" >> $rapportnamef
$FIND  $FOLDER -type f -iname ??.php* -uid 33 >> $rapportnamef
unset datelog

datelog=`date "+%F %H:%M:%S"`
echo -e "[ $datelog ] Scan phase 3/$COUNTPHASE: Search suspected file binary or script file							[Please Wait]"
echo -e "[ $datelog ] Scan phase 3/$COUNTPHASE: Search suspected file binary file" >> $rapportnamef
echo -e "--------------------------------------------------------------------------------------------------------" >> $rapportnamef
$FIND $FOLDER -type f \( -name "*\.bin" -o -name "*\.exe" -o -name "*\.c" -o -name "*\.py" -o -name "*\.sh" -o -name "*\.bash" -o -name "*\.pl" \) >> $rapportnamef
unset datelog

datelog=`date "+%F %H:%M:%S"`
echo -e "[ $datelog ] Scan phase 4/$COUNTPHASE: Search suspected file space in the file extension						[Please Wait]"
echo -e "[ $datelog ] Scan phase 4/$COUNTPHASE: Search suspected file space in the file extension" >> $rapportnamef
echo -e "--------------------------------------------------------------------------------------------------------" >> $rapportnamef
$FIND $FOLDER -name '. *' >> $rapportnamef
unset datelog

datelog=`date "+%F %H:%M:%S"`
echo -e "[ $datelog ] Scan phase 5/$COUNTPHASE: Search suspected Shell not Crypted	and not obfuscates					[Please Wait]"
echo -e "[ $datelog ] Scan phase 5/$COUNTPHASE: Search suspected Shell not Crypted" >> $rapportnamef
echo -e "--------------------------------------------------------------------------------------------------------" >> $rapportnamef
$GREP -roiE --include=*.php* "cgitelnet|PHPShell|r57shell|c99shell|b374k|Jijle|noexecshell|revengans|myshellexec|JGF1dGhfc" $FOLDER  | sort -u>> $rapportnamef
unset datelog

datelog=`date "+%F %H:%M:%S"`
echo -e "[ $datelog ] Scan phase 6/$COUNTPHASE: Search suspected file encrypted shell stroupper/eval						[Please Wait]"
echo -e "[ $datelog ] Scan phase 6/$COUNTPHASE: Search suspected file encrypted shell stroupper/eval" >> $rapportnamef
echo -e "--------------------------------------------------------------------------------------------------------" >> $rapportnamef
$FIND $FOLDER -iname *.php* -exec awk '/]\)\) { eval \(\$/ { a=1 } /=strtoupper \( / { b=1 } END { if ((a*b)==1) print FILENAME}' \{\} \; >> $rapportnamef
unset datelog

datelog=`date "+%F %H:%M:%S"`
echo -e "[ $datelog ] Scan phase 7/$COUNTPHASE: Search suspected file encrypted shell GLOBAL Array PHP						[Please Wait]"
echo -e "[ $datelog ] Scan phase 7/$COUNTPHASE: Search suspected file encrypted shell GLOBAL Array PHP" >> $rapportnamef
echo -e "--------------------------------------------------------------------------------------------------------" >> $rapportnamef
$GREP -roi --include=*.php '$GLOBALS\[$GLOBALS' $FOLDER | sort -u >> $rapportnamef

echo -e "[ $datelog ] Scan phase 8/$COUNTPHASE: Search suspected file obfuscates shell Base64/eval						[Please Wait]"
echo -e "[ $datelog ] Scan phase 8/$COUNTPHASE: Search Search suspected file obfuscates Base64/eval" >> $rapportnamef
echo -e "--------------------------------------------------------------------------------------------------------" >> $rapportnamef
$GREP -roE --include=*.php* -e "ZXZhbChnemluZmxhdGUoYmFzZTY0Xw==" -e "shell%2520gz%252Feval" $FOLDER  | sort -u >> $rapportnamef
unset datelog

datelog=`date "+%F %H:%M:%S"`
echo -e "[ $datelog ] Scan phase 9/$COUNTPHASE: Search suspected file shell or Backdoor Java 							[Please Wait]"
echo -e "[ $datelog ] Scan phase 9/$COUNTPHASE: Search suspected file shell or Backdoor Java" >> $rapportnamef
echo -e "--------------------------------------------------------------------------------------------------------" >> $rapportnamef
$FIND $FOLDER -iname *.php* -exec awk '/document.write/ { a=1 } /\(.\\u00 / { b=1 } END { if ((a*b)==1) print FILENAME}' \{\} \; >> $rapportnamef
unset datelog

datelog=`date "+%F %H:%M:%S"`
echo -e "[ $datelog ] Scan phase 10/$COUNTPHASE: Search suspected file shell obfuscates eval/gz/base64						[Please Wait]"
echo -e "[ $datelog ] Scan phase 10/$COUNTPHASE: Search suspected file shell obfuscates eval/gz/base64" >> $rapportnamef
echo -e "--------------------------------------------------------------------------------------------------------" >> $rapportnamef
$GREP -roE --include=*.php* -e "eval\(gzinflate\(base64_" -e "ZXZhbChnemluZmxhdGUoYmFzZTY0Xw==" -e "6576616C28677A696E666C617465286261736536345F" -e "\x65\x76\x61\x6C\x28\x67\x7A\x69\x6E\x66\x6C\x61\x74\x65\x28\x62\x61\x73\x65\x36\x34\x5F" -e "eval%28gzinflate%28base64_" $FOLDER  | sort -u >> $rapportnamef
unset datelog

datelog=`date "+%F %H:%M:%S"`
echo -e "[ $datelog ] Scan phase 11/$COUNTPHASE: Search suspected file shell obfuscates eval/gz/strrot13/base64					[Please Wait]"
echo -e "[ $datelog ] Scan phase 11/$COUNTPHASE: Search suspected file shell obfuscates eval/gz/strrot13/base64" >> $rapportnamef
echo -e "--------------------------------------------------------------------------------------------------------" >> $rapportnamef
$GREP -roE --include=*.php* -e "eval\(gzinflate\(str_rot13\(base64_" -e "ZXZhbChnemluZmxhdGUoc3RyX3JvdDEzKGJhc2U2NF8=" -e "6576616C28677A696E666C617465287374725F726F743133286261736536345F" -e "\x65\x76\x61\x6C\x28\x67\x7A\x69\x6E\x66\x6C\x61\x74\x65\x28\x73\x74\x72\x5F\x72\x6F\x74\x31\x33\x28\x62\x61\x73\x65\x36\x34\x5F" -e "eval%28gzinflate%28str_rot13%28base64_" $FOLDER  | sort -u >> $rapportnamef
unset datelog

datelog=`date "+%F %H:%M:%S"`
echo -e "[ $datelog ] Scan phase 12/$COUNTPHASE: Search suspected file shell obfuscates eval/gzuncompress/base64					[Please Wait]"
echo -e "[ $datelog ] Scan phase 12/$COUNTPHASE: Search suspected file shell obfuscates eval/gzuncompress/base64" >> $rapportnamef
echo -e "--------------------------------------------------------------------------------------------------------" >> $rapportnamef
$GREP -roE --include=*.php* -e "eval\(gzuncompress\(base64_" -e "ZXZhbChnenVuY29tcHJlc3MoYmFzZTY0Xw==" -e "6576616C28677A756E636F6D7072657373286261736536345F" -e "\x65\x76\x61\x6C\x28\x67\x7A\x75\x6E\x63\x6F\x6D\x70\x72\x65\x73\x73\x28\x62\x61\x73\x65\x36\x34\x5F" -e "eval%28gzuncompress%28base64_" $FOLDER  | sort -u >> $rapportnamef
unset datelog

datelog=`date "+%F %H:%M:%S"`
echo -e "[ $datelog ] Scan phase 13/$COUNTPHASE: Search suspected file shell obfuscates eval/gzuncompress/strrot13/base64				[Please Wait]"
echo -e "[ $datelog ] Scan phase 13/$COUNTPHASE: Search suspected file shell obfuscates eval/gzuncompress/strrot13/base64" >> $rapportnamef
echo -e "--------------------------------------------------------------------------------------------------------" >> $rapportnamef
$GREP -roE --include=*.php* -e "eval\(gzuncompress\(str_rot13\(base64_" -e "ZXZhbChnenVuY29tcHJlc3Moc3RyX3JvdDEzKGJhc2U2NF8=" -e "6576616C28677A756E636F6D7072657373287374725F726F743133286261736536345F" -e "\x65\x76\x61\x6C\x28\x67\x7A\x75\x6E\x63\x6F\x6D\x70\x72\x65\x73\x73\x28\x73\x74\x72\x5F\x72\x6F\x74\x31\x33\x28\x62\x61\x73\x65\x36\x34\x5F" -e "eval%28gzuncompress%28str_rot13%28base64_" $FOLDER  | sort -u >> $rapportnamef
unset datelog

datelog=`date "+%F %H:%M:%S"`
echo -e "[ $datelog ] Scan phase 14/$COUNTPHASE: Search suspected file shell obfuscates eval/strrot13/gzinflate/base64				[Please Wait]"
echo -e "[ $datelog ] Scan phase 14/$COUNTPHASE: Search suspected file shell obfuscates eval/strrot13/gzinflate/base64" >> $rapportnamef
echo -e "--------------------------------------------------------------------------------------------------------" >> $rapportnamef
$GREP -roE --include=*.php* -e "eval\(str_rot13\(gzinflate\(base64_" -e "ZXZhbChzdHJfcm90MTMoZ3ppbmZsYXRlKGJhc2U2NF8=" -e "6576616C287374725F726F74313328677A696E666C617465286261736536345F" -e "\x65\x76\x61\x6C\x28\x73\x74\x72\x5F\x72\x6F\x74\x31\x33\x28\x67\x7A\x69\x6E\x66\x6C\x61\x74\x65\x28\x62\x61\x73\x65\x36\x34\x5F" -e "eval%28str_rot13%28gzinflate%28base64_" $FOLDER  | sort -u >> $rapportnamef
unset datelog

datelog=`date "+%F %H:%M:%S"`
echo -e "[ $datelog ] Scan phase 15/$COUNTPHASE: Search suspected file shell obfuscates eval/gzinflate/base64_decode/strrev/strrot13		[Please Wait]"
echo -e "[ $datelog ] Scan phase 15/$COUNTPHASE: Search suspected file shell obfuscates eval/gzinflate/base64_decode/strrev/strrot13" >> $rapportnamef
echo -e "--------------------------------------------------------------------------------------------------------" >> $rapportnamef
$GREP -roE --include=*.php* -e "eval\(gzinflate\(base64_decode\(strrev\(str_rot13\(" -e "ZXZhbChnemluZmxhdGUoYmFzZTY0X2RlY29kZShzdHJyZXYoc3RyX3JvdDEzKA==" -e "6576616C28677A696E666C617465286261736536345F6465636F646528737472726576287374725F726F74313328" -e "\x65\x76\x61\x6C\x28\x67\x7A\x69\x6E\x66\x6C\x61\x74\x65\x28\x62\x61\x73\x65\x36\x34\x5F\x64\x65\x63\x6F\x64\x65\x28\x73\x74\x72\x72\x65\x76\x28\x73\x74\x72\x5F\x72\x6F\x74\x31\x33\x28" -e "eval%28gzinflate%28base64_decode%28strrev%28str_rot13%28" $FOLDER  | sort -u >> $rapportnamef
unset datelog

datelog=`date "+%F %H:%M:%S"`
echo -e "[ $datelog ] Scan phase 16/$COUNTPHASE: Search suspected file shell obfuscates eval/base64_decode/gzuncompress/base64_decode		[Please Wait]"
echo -e "[ $datelog ] Scan phase 16/$COUNTPHASE: Search suspected file shell obfuscates eval/base64_decode/gzuncompress/base64_decode" >> $rapportnamef
echo -e "--------------------------------------------------------------------------------------------------------" >> $rapportnamef
$GREP -roE --include=*.php* -e "eval\(base64_decode\(gzuncompress\(base64_decode\(" -e "ZXZhbChiYXNlNjRfZGVjb2RlKGd6dW5jb21wcmVzcyhiYXNlNjRfZGVjb2RlKA==" -e "6576616C286261736536345F6465636F646528677A756E636F6D7072657373286261736536345F6465636F646528" -e "\x65\x76\x61\x6C\x28\x62\x61\x73\x65\x36\x34\x5F\x64\x65\x63\x6F\x64\x65\x28\x67\x7A\x75\x6E\x63\x6F\x6D\x70\x72\x65\x73\x73\x28\x62\x61\x73\x65\x36\x34\x5F\x64\x65\x63\x6F\x64\x65\x28" -e "eval%28base64_decode%28gzuncompress%28base64_decode%28" $FOLDER  | sort -u >> $rapportnamef
unset datelog

datelog=`date "+%F %H:%M:%S"`
echo -e "[ $datelog ] Scan phase 17/$COUNTPHASE: Search suspected file shell obfuscates eval/gzinflate/base64_decode/strrev			[Please Wait]"
echo -e "[ $datelog ] Scan phase 17/$COUNTPHASE: Search suspected file shell obfuscates eval/gzinflate/base64_decode/strrev" >> $rapportnamef
echo -e "--------------------------------------------------------------------------------------------------------" >> $rapportnamef
$GREP -roE --include=*.php* -e "eval\(gzinflate\(base64_decode\(strrev\(" -e "ZXZhbChnemluZmxhdGUoYmFzZTY0X2RlY29kZShzdHJyZXYo" -e "6576616C28677A696E666C617465286261736536345F6465636F64652873747272657628" -e "\x65\x76\x61\x6C\x28\x67\x7A\x69\x6E\x66\x6C\x61\x74\x65\x28\x62\x61\x73\x65\x36\x34\x5F\x64\x65\x63\x6F\x64\x65\x28\x73\x74\x72\x72\x65\x76\x28" -e "eval%28gzinflate%28base64_decode%28strrev%28" $FOLDER  | sort -u >> $rapportnamef
unset datelog

datelog=`date "+%F %H:%M:%S"`
echo -e "[ $datelog ] Scan phase 18/$COUNTPHASE: Search suspected file shell obfuscates eval/gzinflate/base64_decode/str_rot13			[Please Wait]"
echo -e "[ $datelog ] Scan phase 18/$COUNTPHASE: Search suspected file shell obfuscates eval/gzinflate/base64_decode/str_rot13" >> $rapportnamef
echo -e "--------------------------------------------------------------------------------------------------------" >> $rapportnamef
$GREP -roE --include=*.php* -e "eval\(gzinflate\(base64_decode\(str_rot13\(" -e "ZXZhbChnemluZmxhdGUoYmFzZTY0X2RlY29kZShzdHJfcm90MTMo" -e "6576616C28677A696E666C617465286261736536345F6465636F6465287374725F726F74313328" -e "\x65\x76\x61\x6C\x28\x67\x7A\x69\x6E\x66\x6C\x61\x74\x65\x28\x62\x61\x73\x65\x36\x34\x5F\x64\x65\x63\x6F\x64\x65\x28\x73\x74\x72\x5F\x72\x6F\x74\x31\x33\x28" -e "eval%28gzinflate%28base64_decode%28str_rot13%28" $FOLDER  | sort -u >> $rapportnamef
unset datelog

datelog=`date "+%F %H:%M:%S"`
echo -e "[ $datelog ] Scan phase 19/$COUNTPHASE: Search suspected file shell obfuscates eval/gzinflate/base64_decode/str_rot13/strrev		[Please Wait]"
echo -e "[ $datelog ] Scan phase 19/$COUNTPHASE: Search suspected file shell obfuscates eval/gzinflate/base64_decode/str_rot13/strrev" >> $rapportnamef
echo -e "--------------------------------------------------------------------------------------------------------" >> $rapportnamef
$GREP -roE --include=*.php* -e "eval\(gzinflate\(base64_decode\(str_rot13\(strrev\(" -e "ZXZhbChnemluZmxhdGUoYmFzZTY0X2RlY29kZShzdHJfcm90MTMoc3RycmV2KA==" -e "6576616C28677A696E666C617465286261736536345F6465636F6465287374725F726F7431332873747272657628" -e "\x65\x76\x61\x6C\x28\x67\x7A\x69\x6E\x66\x6C\x61\x74\x65\x28\x62\x61\x73\x65\x36\x34\x5F\x64\x65\x63\x6F\x64\x65\x28\x73\x74\x72\x5F\x72\x6F\x74\x31\x33\x28\x73\x74\x72\x72\x65\x76\x28" -e "eval%28gzinflate%28base64_decode%28str_rot13%28strrev%28" $FOLDER  | sort -u >> $rapportnamef
unset datelog

datelog=`date "+%F %H:%M:%S"`
echo -e "[ $datelog ] Scan phase 20/$COUNTPHASE: Search suspected file shell obfuscates eval/gzinflate/base64_decode/rawurldecode			[Please Wait]"
echo -e "[ $datelog ] Scan phase 20/$COUNTPHASE: Search suspected file shell obfuscates eval/gzinflate/base64_decode/rawurldecode" >> $rapportnamef
echo -e "--------------------------------------------------------------------------------------------------------" >> $rapportnamef
$GREP -roE --include=*.php* -e "eval\(gzinflate\(base64_decode\(str_rot13\(strrev\(" -e "ZXZhbChnemluZmxhdGUoYmFzZTY0X2RlY29kZShyYXd1cmxkZWNvZGUo" -e "6576616C28677A696E666C617465286261736536345F6465636F64652872617775726C6465636F646528" -e "\x65\x76\x61\x6C\x28\x67\x7A\x69\x6E\x66\x6C\x61\x74\x65\x28\x62\x61\x73\x65\x36\x34\x5F\x64\x65\x63\x6F\x64\x65\x28\x72\x61\x77\x75\x72\x6C\x64\x65\x63\x6F\x64\x65\x28" -e "eval%28gzinflate%28base64_decode%28rawurldecode%28" $FOLDER  | sort -u >> $rapportnamef
unset datelog

datelog=`date "+%F %H:%M:%S"`
echo -e "[ $datelog ] Scan phase 21/$COUNTPHASE: Search suspected file shell obfuscates eval/str_rot13/str_rot13/base64_decode			[Please Wait]"
echo -e "[ $datelog ] Scan phase 21/$COUNTPHASE: Search suspected file shell obfuscates eval/str_rot13/str_rot13/base64_decode" >> $rapportnamef
echo -e "--------------------------------------------------------------------------------------------------------" >> $rapportnamef
$GREP -roE --include=*.php* -e "eval\(str_rot13\(gzinflate\(str_rot13\(base64_decode\(" -e "ZXZhbChzdHJfcm90MTMoZ3ppbmZsYXRlKHN0cl9yb3QxMyhiYXNlNjRfZGVjb2RlKA==" -e "6576616C287374725F726F74313328677A696E666C617465287374725F726F743133286261736536345F6465636F646528" -e "\x65\x76\x61\x6C\x28\x73\x74\x72\x5F\x72\x6F\x74\x31\x33\x28\x67\x7A\x69\x6E\x66\x6C\x61\x74\x65\x28\x73\x74\x72\x5F\x72\x6F\x74\x31\x33\x28\x62\x61\x73\x65\x36\x34\x5F\x64\x65\x63\x6F\x64\x65\x28" -e "eval%28str_rot13%28gzinflate%28str_rot13%28base64_decode%28" $FOLDER  | sort -u >> $rapportnamef


unset datelog
datelog=`date "+%F %H:%M:%S"`
echo -e "[ $datelog ] Scan phase 22/$COUNTPHASE: Search suspected file shell payload 							[Please Wait]"
echo -e "[ $datelog ] Scan phase 22/$COUNTPHASE: Search suspected file shell payload	" >> $rapportnamef
echo -e "--------------------------------------------------------------------------------------------------------" >> $rapportnamef
$FIND $FOLDER -iname *.php* -exec awk '/php \$payload\=/ { a=1 } /preg_replace\(/ { b=1 } END { if ((a*b)==1) print FILENAME}' \{\} \; >> $rapportnamef
unset datelog

datelog=`date "+%F %H:%M:%S"`
echo -e "[ $datelog ] Scan phase 23/$COUNTPHASE: Search suspected file shell payload encrypt							[Please Wait]"
echo -e "[ $datelog ] Scan phase 23/$COUNTPHASE: Search suspected file shell payload encrypt	" >> $rapportnamef
echo -e "--------------------------------------------------------------------------------------------------------" >> $rapportnamef
$GREP -roE --include=*.php* -e 'php $payload=' -e 'cGhwICRwYXlsb2FkPQ==' -e '6576616C287374725F726F74313328677A696E666C617465287374725F726F743133286261736536345F6465636F646528' -e '\x70\x68\x70\x20\x24\x70\x61\x79\x6C\x6F\x61\x64\x3D' -e 'php+%24payload%3D' $FOLDER  | sort -u >> $rapportnamef

datelog=`date "+%F %H:%M:%S"`
echo -e "[ $datelog ] Scan phase 24/$COUNTPHASE: Search suspected file SSI Script obfuscates or not						[Please Wait]"
echo -e "[ $datelog ] Scan phase 24/$COUNTPHASE: Search suspected file SSI Script obfuscates or not		" >> $rapportnamef
echo -e "--------------------------------------------------------------------------------------------------------" >> $rapportnamef
$GREP -roE --include=*.php* --include=*.htm* --include=*.xhtm* -e "<!-- #cmd=\"" -e "PCEtLSAjY21kPSI=" -e "3C212D2D2023636D643D22" -e "\x3C\x21\x2D\x2D\x20\x23\x63\x6D\x64\x3D\x22" $FOLDER  | sort -u >> $rapportnamef

datelog=`date "+%F %H:%M:%S"`
echo -e "[ $datelog ] Scan phase 25/$COUNTPHASE: Search suspected file JavaScript obfuscates							[Please Wait]"
echo -e "[ $datelog ] Scan phase 25/$COUNTPHASE: Search suspected file JavaScript obfuscates		" >> $rapportnamef
echo -e "--------------------------------------------------------------------------------------------------------" >> $rapportnamef
$GREP -roE --include=*.php* --include=*.htm* --include=*.xhtm* -e "<sc​ript>eval\(function\(p,a,c,k,e,d\)" -e "<sc​ript>date=new Date\(\)" -e "<!-- . --><script&gt" -e "<script>el=do​cument.createElement\(\"div\"\);el.innerHTML=" $FOLDER  | sort -u >> $rapportnamef

unset datelog
datelog=`date "+%F %H:%M:%S"`
echo -e "--------------------------------------------------------------------------------------------------------" >> $rapportnamef
echo ""	>> $rapportnamef
echo "" >> $rapportnamef
echo "Finishe : $datelog" >> $rapportnamef
echo -e "----------------------------------- <=== SCAN Finish ===> ----------------------------------------------"
echo ""
echo ""
echo "Finishe : $datelog"
echo "Rapport name: $rapportnamef"
echo ""

exit 0

